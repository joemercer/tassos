"use strict";angular.module("tassosApp",[]),angular.module("tassosApp").controller("MainCtrl",["$scope","Logging","CardsService",function(a,b,c){a.card={title:"Press the spinner",description:"You gotta if you wanna start the game o_O"},a.next=function(){a.card=c.get(),b.log({type:"next_card_requested",cardNumber:a.card.cardnumber}),a.card.secondspin>0&&a.spin(),b.output()},a.degrees=0,a.spin=function(){a.degrees+=360+720*Math.random(),(-45<(a.degrees-180)%360-360&&(a.degrees-180)%360-360<45||-45<(a.degrees-180)%360&&(a.degrees-180)%360<45)&&(a.degrees+=90),$(".spinner").css({"-webkit-transform":"rotate("+a.degrees+"deg)","-moz-transform":"rotate("+a.degrees+"deg)","-ms-transform":"rotate("+a.degrees+"deg)",transform:"rotate("+a.degrees+"deg)"})},a.rateGood=function(){d()&&b.log({type:"card_rated",cardNumber:a.card.cardnumber,cardRating:"Good"})},a.rateMeh=function(){d()&&b.log({type:"card_rated",cardNumber:a.card.cardnumber,cardRating:"Meh"})},a.rateBad=function(){d()&&b.log({type:"card_rated",cardNumber:a.card.cardnumber,cardRating:"Bad"})};var d=function(){return a.card.cardnumber?!0:!1}}]),angular.module("tassosApp").service("CardsService",function(){var a="https://docs.google.com/spreadsheets/d/115idP64c_fvIxJw6zm6A8-feGbCjOeYxp3DnOPwMBhM/pubhtml";this.cards=[],this.current=0,this.get=function(){if(!this.cards.length)return{error:!0,message:"Loading cards... hold on"};var a=this.cards[this.current];return a?(this.current++,a):{error:!0,message:"Ran out of cards :(",title:"Last card!",description:"Reload the page if you dare to play again"}},Tabletop.init({key:a,simpleSheet:!0,parseNumbers:!0,callback:angular.bind(this,function(a){this.cards=a})})}),angular.module("tassosApp").service("Logging",function(){if(this.logger=null,this.backlog=[],this.log=function(a){return a.timestamp=(new Date).getTime(),this.logger?void this.logger.insert(a):void this.backlog.push(a)},this.output=function(){return this.logger?void console.log(this.logger.query()):void console.log("no logger")},this.dropbox=new Dropbox.Client({key:"dg7kh1gl7wv9gj2",secret:"hp1rh6n8ia9fabr",token:"05PF-9qnGb8AAAAAAAAABEI3DKas5jHeRJcOMxH_U-I4a-JLcDkTS-ww3tTiEkWu"}),this.dropbox.isAuthenticated()){var a=this.dropbox.getDatastoreManager();a.openDefaultDatastore(angular.bind(this,function(a,b){a&&console.log("Error opening default datastore: "+a),this.logger=b.getTable("test");for(var c=0;c<this.backlog.length;++c)this.logger.insert(this.backlog[c]);this.backlog=[]}))}});